{"version":3,"file":"files_downloadlimit-admin.mjs","sources":["../node_modules/@nextcloud/vue/dist/chunks/NcSettingsSection-Bp99Q74i.mjs","../src/services/AdminService.ts","../src/views/AdminSettings.vue","../src/admin.ts"],"sourcesContent":["import '../assets/NcSettingsSection-f5rBJsKJ.css';\nimport { createElementBlock, openBlock, mergeProps, createElementVNode, createCommentVNode, toDisplayString, defineComponent, renderSlot, createTextVNode, unref, createVNode } from \"vue\";\nimport { _ as _export_sfc } from \"./_plugin-vue_export-helper-1tPrXgE0.mjs\";\nimport { r as register, a as t } from \"./_l10n-CeXHJQB0.mjs\";\nconst _sfc_main$1 = {\n  name: \"HelpCircleIcon\",\n  emits: [\"click\"],\n  props: {\n    title: {\n      type: String\n    },\n    fillColor: {\n      type: String,\n      default: \"currentColor\"\n    },\n    size: {\n      type: Number,\n      default: 24\n    }\n  }\n};\nconst _hoisted_1$1 = [\"aria-hidden\", \"aria-label\"];\nconst _hoisted_2$1 = [\"fill\", \"width\", \"height\"];\nconst _hoisted_3$1 = { d: \"M15.07,11.25L14.17,12.17C13.45,12.89 13,13.5 13,15H11V14.5C11,13.39 11.45,12.39 12.17,11.67L13.41,10.41C13.78,10.05 14,9.55 14,9C14,7.89 13.1,7 12,7A2,2 0 0,0 10,9H8A4,4 0 0,1 12,5A4,4 0 0,1 16,9C16,9.88 15.64,10.67 15.07,11.25M13,19H11V17H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12C22,6.47 17.5,2 12,2Z\" };\nconst _hoisted_4$1 = { key: 0 };\nfunction _sfc_render(_ctx, _cache, $props, $setup, $data, $options) {\n  return openBlock(), createElementBlock(\"span\", mergeProps(_ctx.$attrs, {\n    \"aria-hidden\": $props.title ? null : \"true\",\n    \"aria-label\": $props.title,\n    class: \"material-design-icon help-circle-icon\",\n    role: \"img\",\n    onClick: _cache[0] || (_cache[0] = ($event) => _ctx.$emit(\"click\", $event))\n  }), [\n    (openBlock(), createElementBlock(\"svg\", {\n      fill: $props.fillColor,\n      class: \"material-design-icon__svg\",\n      width: $props.size,\n      height: $props.size,\n      viewBox: \"0 0 24 24\"\n    }, [\n      createElementVNode(\"path\", _hoisted_3$1, [\n        $props.title ? (openBlock(), createElementBlock(\"title\", _hoisted_4$1, toDisplayString($props.title), 1)) : createCommentVNode(\"\", true)\n      ])\n    ], 8, _hoisted_2$1))\n  ], 16, _hoisted_1$1);\n}\nconst HelpCircle = /* @__PURE__ */ _export_sfc(_sfc_main$1, [[\"render\", _sfc_render]]);\nregister();\nconst _hoisted_1 = { class: \"settings-section\" };\nconst _hoisted_2 = { class: \"settings-section__name\" };\nconst _hoisted_3 = [\"aria-label\", \"href\", \"title\"];\nconst _hoisted_4 = {\n  key: 0,\n  class: \"settings-section__desc\"\n};\nconst _sfc_main = /* @__PURE__ */ defineComponent({\n  __name: \"NcSettingsSection\",\n  props: {\n    name: {},\n    description: { default: \"\" },\n    docUrl: { default: \"\" }\n  },\n  setup(__props) {\n    const ariaLabel = t(\"External documentation\");\n    return (_ctx, _cache) => {\n      return openBlock(), createElementBlock(\"div\", _hoisted_1, [\n        createElementVNode(\"h2\", _hoisted_2, [\n          createTextVNode(toDisplayString(_ctx.name) + \" \", 1),\n          _ctx.docUrl ? (openBlock(), createElementBlock(\"a\", {\n            key: 0,\n            \"aria-label\": unref(ariaLabel),\n            class: \"settings-section__info\",\n            href: _ctx.docUrl,\n            rel: \"noreferrer nofollow\",\n            target: \"_blank\",\n            title: unref(ariaLabel)\n          }, [\n            createVNode(HelpCircle, { size: 20 })\n          ], 8, _hoisted_3)) : createCommentVNode(\"\", true)\n        ]),\n        _ctx.description ? (openBlock(), createElementBlock(\"p\", _hoisted_4, toDisplayString(_ctx.description), 1)) : createCommentVNode(\"\", true),\n        renderSlot(_ctx.$slots, \"default\", {}, void 0, true)\n      ]);\n    };\n  }\n});\nconst NcSettingsSection = /* @__PURE__ */ _export_sfc(_sfc_main, [[\"__scopeId\", \"data-v-9cedb949\"]]);\nexport {\n  NcSettingsSection as N\n};\n//# sourceMappingURL=NcSettingsSection-Bp99Q74i.mjs.map\n","/**\n * SPDX-FileCopyrightText: 2024 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport axios from '@nextcloud/axios'\nimport { showError } from '@nextcloud/dialogs'\nimport { t } from '@nextcloud/l10n'\nimport { generateOcsUrl } from '@nextcloud/router'\nimport { logger } from '../logger.ts'\n\n/**\n * Set the default download limit for all shares.\n *\n * @param limit - The new default limit\n */\nexport async function setDefaultLimit(limit: number): Promise<boolean> {\n\ttry {\n\t\tawait axios.put(generateOcsUrl('/apps/files_downloadlimit/api/v1/limit'), {\n\t\t\tlimit,\n\t\t})\n\t\treturn true\n\t} catch (error) {\n\t\tlogger.error('Failed to set default download limit', { error })\n\t\tshowError(t('files_downloadlimit', 'Failed to set default download limit'))\n\t}\n\treturn false\n}\n\n/**\n * Unset the configured default limit\n */\nexport async function removeDefaultLimit(): Promise<boolean> {\n\ttry {\n\t\tawait axios.delete(generateOcsUrl('/apps/files_downloadlimit/api/v1/limit'))\n\t\treturn true\n\t} catch (error) {\n\t\tlogger.error('Failed to remove default download limit', { error })\n\t\tshowError(t('files_downloadlimit', 'Failed to remove default download limit'))\n\t}\n\treturn false\n}\n","<!--\n  - SPDX-FileCopyrightText: 2024 Nextcloud GmbH and Nextcloud contributors\n  - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n\n<template>\n\t<NcSettingsSection\n\t\t:name=\"t('files_downloadlimit', 'Download limit')\"\n\t\t:description=\"t('files_downloadlimit', 'Configure the default download limit for external shares.')\">\n\t\t<NcCheckboxRadioSwitch\n\t\t\tv-model=\"enableDefaultLimit\"\n\t\t\t:loading=\"showLoading\"\n\t\t\ttype=\"switch\">\n\t\t\t{{ t('files_downloadlimit', 'Default download limit for external shares') }}\n\t\t</NcCheckboxRadioSwitch>\n\n\t\t<NcTextField\n\t\t\tv-show=\"enableDefaultLimit\"\n\t\t\tv-model=\"limit\"\n\t\t\tclass=\"settings__field\"\n\t\t\t:disabled=\"!enableDefaultLimit || showLoading\"\n\t\t\t:label=\"t('files_downloadlimit', 'Set default download limit')\"\n\t\t\ttype=\"number\"\n\t\t\tmin=\"1\"\n\t\t\t:helper-text=\"helperText\"\n\t\t\t:error=\"Boolean(helperText)\"\n\t\t\t:success=\"showSuccess\" />\n\t\t<div v-show=\"!enableDefaultLimit\" class=\"settings__placeholder\" />\n\t</NcSettingsSection>\n</template>\n\n<script lang=\"ts\">\nimport { loadState } from '@nextcloud/initial-state'\nimport { translate as t } from '@nextcloud/l10n'\nimport { defineComponent } from 'vue'\nimport NcCheckboxRadioSwitch from '@nextcloud/vue/components/NcCheckboxRadioSwitch'\nimport NcSettingsSection from '@nextcloud/vue/components/NcSettingsSection'\nimport NcTextField from '@nextcloud/vue/components/NcTextField'\nimport { removeDefaultLimit, setDefaultLimit } from '../services/AdminService.ts'\n\nconst defaultDownloadLimit = loadState<number>('files_downloadlimit', 'default-download-limit', -1)\n\nexport default defineComponent({\n\tname: 'AdminSettings',\n\n\tcomponents: {\n\t\tNcCheckboxRadioSwitch,\n\t\tNcSettingsSection,\n\t\tNcTextField,\n\t},\n\n\tdata() {\n\t\treturn {\n\t\t\tlimit: Math.max(defaultDownloadLimit, 10),\n\t\t\tenableDefaultLimit: defaultDownloadLimit !== -1,\n\t\t\tshowLoading: false,\n\t\t\tshowSuccess: false,\n\t\t}\n\t},\n\n\tcomputed: {\n\t\thelperText() {\n\t\t\tif (typeof this.limit === 'number' && this.limit <= 0) {\n\t\t\t\treturn t('files_downloadlimit', 'The minimum limit is 1')\n\t\t\t}\n\t\t\treturn ''\n\t\t},\n\t},\n\n\twatch: {\n\t\tasync limit(limit: number) {\n\t\t\tif (await setDefaultLimit(limit)) {\n\t\t\t\tthis.showSuccess = true\n\t\t\t\twindow.setTimeout(() => {\n\t\t\t\t\tthis.showSuccess = false\n\t\t\t\t}, 1000)\n\t\t\t}\n\t\t},\n\n\t\tasync enableDefaultLimit(enabled: boolean, oldValue: boolean) {\n\t\t\tthis.showLoading = true\n\t\t\tlet success: boolean\n\t\t\tif (enabled) {\n\t\t\t\tsuccess = await setDefaultLimit(10)\n\t\t\t} else {\n\t\t\t\tsuccess = await removeDefaultLimit()\n\t\t\t}\n\n\t\t\tif (!success) {\n\t\t\t\tthis.enableDefaultLimit = oldValue\n\t\t\t}\n\t\t\tthis.showLoading = false\n\t\t},\n\t},\n\n\tmethods: {\n\t\tt,\n\t},\n})\n</script>\n\n<style lang=\"scss\" scoped>\n.settings {\n\t&__field {\n\t\tmax-width: 500px;\n\t\tmargin-top: calc(3 * var(--default-grid-baseline)) !important;\n\t}\n\n\t&__placeholder {\n\t\t// ensure content does not jump when enable / disable the input\n\t\theight: calc(var(--default-clickable-area) + 3 * var(--default-grid-baseline));\n\t}\n}\n</style>\n","/**\n * SPDX-FileCopyrightText: 2024 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { createApp } from 'vue'\nimport AdminSettings from './views/AdminSettings.vue'\n\ncreateApp(AdminSettings)\n\t.mount('#admin-download-limit')\n"],"names":["_sfc_main$1","_hoisted_1$1","_hoisted_2$1","_hoisted_3$1","_hoisted_4$1","_sfc_render","_ctx","_cache","$props","$setup","$data","$options","openBlock","createElementBlock","mergeProps","$event","createElementVNode","toDisplayString","createCommentVNode","HelpCircle","_export_sfc","register","_hoisted_1","_hoisted_2","_hoisted_3","_hoisted_4","_sfc_main","defineComponent","__props","ariaLabel","t","createTextVNode","unref","createVNode","renderSlot","NcSettingsSection","setDefaultLimit","limit","axios","generateOcsUrl","error","logger","showError","removeDefaultLimit","defaultDownloadLimit","loadState","NcCheckboxRadioSwitch","NcTextField","enabled","oldValue","success","_createBlock","_component_NcSettingsSection","_createVNode","_component_NcCheckboxRadioSwitch","_createTextVNode","_toDisplayString","_component_NcTextField","_withDirectives","_createElementVNode","_vShow","createApp","AdminSettings"],"mappings":"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","x_google_ignoreList":[0]}