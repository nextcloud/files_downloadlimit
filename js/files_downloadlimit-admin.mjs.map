{"version":3,"file":"files_downloadlimit-admin.mjs","sources":["../node_modules/@nextcloud/vue/dist/chunks/NcSettingsSection-C76Kqeew.mjs","../src/services/AdminService.ts","../src/views/AdminSettings.vue","../src/admin.ts"],"sourcesContent":["import '../assets/NcSettingsSection-_mX6UqM_.css';\nimport { r as register, w as t23, a as t } from \"./_l10n-DQgzdF9S.mjs\";\nimport { n as normalizeComponent } from \"./_plugin-vue2_normalizer-DU4iP6Vu.mjs\";\nregister(t23);\nconst _sfc_main$1 = {\n  name: \"HelpCircleIcon\",\n  emits: [\"click\"],\n  props: {\n    title: {\n      type: String\n    },\n    fillColor: {\n      type: String,\n      default: \"currentColor\"\n    },\n    size: {\n      type: Number,\n      default: 24\n    }\n  }\n};\nvar _sfc_render$1 = function render() {\n  var _vm = this, _c = _vm._self._c;\n  return _c(\"span\", _vm._b({ staticClass: \"material-design-icon help-circle-icon\", attrs: { \"aria-hidden\": _vm.title ? null : \"true\", \"aria-label\": _vm.title, \"role\": \"img\" }, on: { \"click\": function($event) {\n    return _vm.$emit(\"click\", $event);\n  } } }, \"span\", _vm.$attrs, false), [_c(\"svg\", { staticClass: \"material-design-icon__svg\", attrs: { \"fill\": _vm.fillColor, \"width\": _vm.size, \"height\": _vm.size, \"viewBox\": \"0 0 24 24\" } }, [_c(\"path\", { attrs: { \"d\": \"M15.07,11.25L14.17,12.17C13.45,12.89 13,13.5 13,15H11V14.5C11,13.39 11.45,12.39 12.17,11.67L13.41,10.41C13.78,10.05 14,9.55 14,9C14,7.89 13.1,7 12,7A2,2 0 0,0 10,9H8A4,4 0 0,1 12,5A4,4 0 0,1 16,9C16,9.88 15.64,10.67 15.07,11.25M13,19H11V17H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12C22,6.47 17.5,2 12,2Z\" } }, [_vm.title ? _c(\"title\", [_vm._v(_vm._s(_vm.title))]) : _vm._e()])])]);\n};\nvar _sfc_staticRenderFns$1 = [];\nvar __component__$1 = /* @__PURE__ */ normalizeComponent(\n  _sfc_main$1,\n  _sfc_render$1,\n  _sfc_staticRenderFns$1,\n  false,\n  null,\n  null\n);\nconst HelpCircle = __component__$1.exports;\nconst _sfc_main = {\n  name: \"NcSettingsSection\",\n  components: {\n    HelpCircle\n  },\n  props: {\n    name: {\n      type: String,\n      required: true\n    },\n    description: {\n      type: String,\n      default: \"\"\n    },\n    docUrl: {\n      type: String,\n      default: \"\"\n    },\n    /**\n     * Limit the width of the setting's content\n     *\n     * Setting this to false allows unrestricted (width) settings content.\n     * Note that the name and description have always a width limit.\n     * @deprecated Will be removed with next version and will not be used on Nextcloud 30+ (always forced to true)\n     */\n    limitWidth: {\n      type: Boolean,\n      default: true\n    }\n  },\n  data() {\n    return {\n      docNameTranslated: t(\"External documentation for {name}\", {\n        name: this.name\n      })\n    };\n  },\n  computed: {\n    forceLimitWidth() {\n      if (this.limitWidth) {\n        return true;\n      }\n      const [major] = window._oc_config?.version.split(\".\", 2) ?? [];\n      return major && Number.parseInt(major) >= 30;\n    },\n    hasDescription() {\n      return this.description.length > 0;\n    },\n    hasDocUrl() {\n      return this.docUrl.length > 0;\n    }\n  }\n};\nvar _sfc_render = function render2() {\n  var _vm = this, _c = _vm._self._c;\n  return _c(\"div\", { staticClass: \"settings-section\", class: { \"settings-section--limit-width\": _vm.forceLimitWidth } }, [_c(\"h2\", { staticClass: \"settings-section__name\" }, [_vm._v(\" \" + _vm._s(_vm.name) + \" \"), _vm.hasDocUrl ? _c(\"a\", { staticClass: \"settings-section__info\", attrs: { \"href\": _vm.docUrl, \"title\": _vm.docNameTranslated, \"aria-label\": _vm.docNameTranslated, \"target\": \"_blank\", \"rel\": \"noreferrer nofollow\" } }, [_c(\"HelpCircle\", { attrs: { \"size\": 20 } })], 1) : _vm._e()]), _vm.hasDescription ? _c(\"p\", { staticClass: \"settings-section__desc\" }, [_vm._v(\" \" + _vm._s(_vm.description) + \" \")]) : _vm._e(), _vm._t(\"default\")], 2);\n};\nvar _sfc_staticRenderFns = [];\nvar __component__ = /* @__PURE__ */ normalizeComponent(\n  _sfc_main,\n  _sfc_render,\n  _sfc_staticRenderFns,\n  false,\n  null,\n  \"6f6953b5\"\n);\nconst NcSettingsSection = __component__.exports;\nexport {\n  NcSettingsSection as N\n};\n//# sourceMappingURL=NcSettingsSection-C76Kqeew.mjs.map\n","/**\n * SPDX-FileCopyrightText: 2024 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport axios from '@nextcloud/axios'\nimport { generateOcsUrl } from '@nextcloud/router'\n\nexport const setDefaultLimit = async (limit: number): Promise<[]> => {\n\tconst response = await axios.put(generateOcsUrl('/apps/files_downloadlimit/api/v1/limit'), {\n\t\tlimit,\n\t})\n\treturn response.data.ocs.data\n}\n","<!--\n  - SPDX-FileCopyrightText: 2024 Nextcloud GmbH and Nextcloud contributors\n  - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n\n<template>\n\t<NcSettingsSection :name=\"t('files_downloadlimit', 'Download limit')\"\n\t\t:description=\"t('files_downloadlimit', 'Configure the default download limit for external shares.')\">\n\t\t<form @submit.prevent=\"handleSave\">\n\t\t\t<NcTextField class=\"settings__field\"\n\t\t\t\t:label=\"t('files_downloadlimit', 'Set default download limit')\"\n\t\t\t\ttype=\"number\"\n\t\t\t\tmin=\"1\"\n\t\t\t\t:value=\"limit\"\n\t\t\t\t:helper-text=\"helperText\"\n\t\t\t\t:error=\"Boolean(helperText)\"\n\t\t\t\t:success=\"showSuccess\"\n\t\t\t\t:show-trailing-button=\"showTrailingButton\"\n\t\t\t\ttrailing-button-icon=\"arrowRight\"\n\t\t\t\t@update:value=\"handleUpdateLimit\"\n\t\t\t\t@trailing-button-click=\"handleSave\" />\n\t\t</form>\n\t</NcSettingsSection>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent } from 'vue'\nimport { loadState } from '@nextcloud/initial-state'\nimport { translate as t } from '@nextcloud/l10n'\nimport { showError } from '@nextcloud/dialogs'\n\nimport NcSettingsSection from '@nextcloud/vue/dist/Components/NcSettingsSection.js'\nimport NcTextField from '@nextcloud/vue/dist/Components/NcTextField.js'\n\nimport { setDefaultLimit } from '../services/AdminService.ts'\n\nconst defaultDownloadLimit = loadState<number>('files_downloadlimit', 'default-download-limit', -1)\n// If a default is not set (-1) then the input should be empty\nconst limit: '' | number = defaultDownloadLimit === -1 ? '' : defaultDownloadLimit\n\nexport default defineComponent({\n\tname: 'AdminSettings',\n\n\tcomponents: {\n\t\tNcSettingsSection,\n\t\tNcTextField,\n\t},\n\n\tdata() {\n\t\treturn {\n\t\t\tlimit,\n\t\t\tsavedLimit: limit,\n\t\t\tshowSuccess: false,\n\t\t}\n\t},\n\n\tcomputed: {\n\t\thelperText() {\n\t\t\tif (typeof this.limit !== 'number') {\n\t\t\t\treturn ''\n\t\t\t}\n\t\t\tif (this.limit > 0) {\n\t\t\t\treturn ''\n\t\t\t}\n\t\t\treturn t('files_downloadlimit', 'The minimum limit is 1')\n\t\t},\n\n\t\tshowTrailingButton() {\n\t\t\treturn typeof this.limit === 'number'\n\t\t\t\t&& this.limit > 0\n\t\t\t\t&& this.limit !== this.savedLimit\n\t\t},\n\t},\n\n\tmethods: {\n\t\tt,\n\n\t\thandleUpdateLimit(limit: string) {\n\t\t\tthis.limit = Number(limit) // emitted <input> value is string so we parse it to number\n\t\t},\n\n\t\tasync handleSave() {\n\t\t\tconst isValid = typeof this.limit === 'number' && this.limit > 0\n\t\t\tif (!isValid) {\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tawait setDefaultLimit(this.limit)\n\t\t\t\tthis.savedLimit = this.limit\n\t\t\t\tthis.showSuccess = true\n\t\t\t\tsetTimeout(() => { this.showSuccess = false }, 3000)\n\t\t\t} catch (error) {\n\t\t\t\tshowError(t('files_downloadlimit', 'Failed to set default download limit'))\n\t\t\t}\n\t\t},\n\t},\n})\n</script>\n\n<style lang=\"scss\" scoped>\n.settings {\n\t&__field {\n\t\tmax-width: 500px;\n\t}\n}\n</style>\n","/**\n * SPDX-FileCopyrightText: 2024 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport Vue from 'vue'\n\nimport AdminSettings from './views/AdminSettings.vue'\n\nconst instance = new Vue({\n\trender: h => h(AdminSettings),\n})\ninstance.$mount('#admin-download-limit')\n"],"names":["register","t23","_sfc_main$1","_sfc_render$1","_vm","_c","$event","_sfc_staticRenderFns$1","__component__$1","normalizeComponent","HelpCircle","_sfc_main","t","major","_sfc_render","_sfc_staticRenderFns","__component__","NcSettingsSection","setDefaultLimit","limit","axios","generateOcsUrl","defaultDownloadLimit","loadState","defineComponent","NcTextField","showError","instance","Vue","h","AdminSettings"],"mappings":"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","x_google_ignoreList":[0]}